# Kafka-template

## Шаблон для развёртывания kafka в docker

* Перед развёртыванием необходимо указать в `jaas.conf` админа и необходимых юзеров. (После добавления в работающий кластер требуется перезапуск брокеров) 
* Также необходимо указать в `admin-client.properties` админское подключение для скриптов.


## Управление правами

В директории `scripts`

| Описание                                                           | Скрипт                     | Пример использования                                              |
|--------------------------------------------------------------------|----------------------------|-------------------------------------------------------------------|
| Управляет ACL для одного пользователя и одного топика              | `acl-user-topic.sh`        | `./acl-user-topic.sh user-alice test-1 add Read`                  |
| Управляет ACL для одного пользователя и одной группы консьюмеров   | `acl-user-group.sh`        | `./acl-user-group.sh user-alice test-group add`                   |
| Управляет ACL для одного пользователя сразу для нескольких топиков | `acl-user-multi-topics.sh` | `./acl-user-topics.sh user-alice "test-1 test-2 test-3" add Read` |
---

## Параметры

Скрипты для работы с топиками используют четыре основных аргумента:

1. **USER** – имя пользователя (Kafka principal)
2. **TOPIC** или **TOPICS** – топик или список топиков через пробел
3. **ACTION** – `add` или `remove`
4. **OPERATION** - `Read`, `Write` или `All` (Не участвует в выдаче прав группам)

---

## Примеры

### Добавить права чтения пользователю на один топик

```bash
./acl-user-topic.sh user-alice test-1 add Read
```

###  Удалить права отправки сообщений пользователя на один топик
```bash
./acl-user-topic.sh aliyar test-1 remove Write
```

### Добавить права пользователю на создание и редактирование групп

```bash
./acl-user-group.sh aliyar test-group add
```

### Добавить права пользователю на чтение нескольких топиков

```bash
./acl-user-multi-topics.sh aliyar "test-1 test-2 test-3" add Read
```

### Удалить все права пользователя на несколько топиков

```bash
./acl-user-multi-topics.sh aliyar "test-1 test-2 test-3" remove All
```

## Список прав

| Описание                                                          | Скрипт                           | Пример использования |
|-------------------------------------------------------------------|----------------------------------|--------------------|
| Выводит список всех прав                                          | `topic-list.sh`                  | `./acl-user-topics.sh user-alice "test-1 test-2 test-3" add` |

---

## Параметры

1. **USER** – имя пользователя (Kafka principal)  - опционально

---

## Примеры

### Показать все ACL

```bash
./acl-list.sh
```

### Показать ACL для конкретного пользователя
```bash
./acl-list.sh bob
```
### Советы по использованию
1. Скрипты можно запускать на любом брокере в кластере Kafka. 
2. Перед тем как их запускать скрипты, сделайте файлы исполняемым ```chmod +x ./acl-user-multi-topics.sh```
3. После добавление прав на топик, добавьте права на группу консьюмеров, чтобы юзеры могли создать себе группу
4. Перезагрузка брокера не требуется после добавления или удаления ACL.

## Безопасность

- **ACLs и права пользователей**  
  Будьте внимательны при выдаче прав пользователям. Операция `All` даёт полный доступ к топикам (чтение, запись и управление), поэтому её следует использовать только для доверенных пользователей.

- **Админский доступ**  
  Файлы `admin-client.properties` и  `jaas.conf` содержит учетные данные администратора Kafka и пользователей.
    - Никогда не выкладывайте его в публичные репозитории.
    - Держите доступ к файлу ограниченным на уровне файловой системы (например, `chmod 600`).
    - Используйте его только в скриптах управления ACL и при необходимости администрирования.